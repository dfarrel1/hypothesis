

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>hypothesis.extra.pandas.impl &mdash; Hypothesis 4.28.1 documentation</title>
  

  
  
    <link rel="shortcut icon" href="../../../../_static/favicon.ico"/>
  
  
  

  
  <script type="text/javascript" src="../../../../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../../../" src="../../../../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../../../../_static/jquery.js"></script>
        <script type="text/javascript" src="../../../../_static/underscore.js"></script>
        <script type="text/javascript" src="../../../../_static/doctools.js"></script>
        <script type="text/javascript" src="../../../../_static/language_data.js"></script>
    
    <script type="text/javascript" src="../../../../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../../../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../../../_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../../../index.html" class="icon icon-home"> Hypothesis
          

          
          </a>

          
            
            
              <div class="version">
                4.28.1
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../quickstart.html">Quick start guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../details.html">Details and advanced features</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../settings.html">Settings</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../data.html">What you can generate and how</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../extras.html">First-party extensions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../django.html">Hypothesis for Django users</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../numpy.html">Hypothesis for the Scientific Stack</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../healthchecks.html">Health checks</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../database.html">The Hypothesis Example Database</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../stateful.html">Stateful testing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../supported.html">Compatibility</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../examples.html">Some more examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../community.html">Community</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../manifesto.html">The Purpose of Hypothesis</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../endorsements.html">Testimonials</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../usage.html">Open Source Projects using Hypothesis</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../strategies.html">Projects extending Hypothesis</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../changes.html">Changelog</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../development.html">Ongoing Hypothesis Development</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../support.html">Help and Support</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../packaging.html">Packaging Guidelines</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../reproducing.html">Reproducing Failures</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../../index.html">Hypothesis</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../../../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../../../index.html">Module code</a> &raquo;</li>
        
      <li>hypothesis.extra.pandas.impl</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <h1>Source code for hypothesis.extra.pandas.impl</h1><div class="highlight"><pre>
<span></span><span class="c1"># coding=utf-8</span>
<span class="c1">#</span>
<span class="c1"># This file is part of Hypothesis, which may be found at</span>
<span class="c1"># https://github.com/HypothesisWorks/hypothesis/</span>
<span class="c1">#</span>
<span class="c1"># Most of this work is copyright (C) 2013-2019 David R. MacIver</span>
<span class="c1"># (david@drmaciver.com), but it contains contributions by others. See</span>
<span class="c1"># CONTRIBUTING.rst for a full list of people who may hold copyright, and</span>
<span class="c1"># consult the git log if you need to determine who owns an individual</span>
<span class="c1"># contribution.</span>
<span class="c1">#</span>
<span class="c1"># This Source Code Form is subject to the terms of the Mozilla Public License,</span>
<span class="c1"># v. 2.0. If a copy of the MPL was not distributed with this file, You can</span>
<span class="c1"># obtain one at https://mozilla.org/MPL/2.0/.</span>
<span class="c1">#</span>
<span class="c1"># END HEADER</span>

<span class="kn">from</span> <span class="nn">__future__</span> <span class="k">import</span> <span class="n">absolute_import</span><span class="p">,</span> <span class="n">division</span><span class="p">,</span> <span class="n">print_function</span>

<span class="kn">from</span> <span class="nn">copy</span> <span class="k">import</span> <span class="n">copy</span>

<span class="kn">import</span> <span class="nn">attr</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span>

<span class="kn">import</span> <span class="nn">hypothesis._strategies</span> <span class="k">as</span> <span class="nn">st</span>
<span class="kn">import</span> <span class="nn">hypothesis.extra.numpy</span> <span class="k">as</span> <span class="nn">npst</span>
<span class="kn">import</span> <span class="nn">hypothesis.internal.conjecture.utils</span> <span class="k">as</span> <span class="nn">cu</span>
<span class="kn">from</span> <span class="nn">hypothesis.control</span> <span class="k">import</span> <span class="n">reject</span>
<span class="kn">from</span> <span class="nn">hypothesis.errors</span> <span class="k">import</span> <span class="n">InvalidArgument</span>
<span class="kn">from</span> <span class="nn">hypothesis.internal.compat</span> <span class="k">import</span> <span class="n">OrderedDict</span><span class="p">,</span> <span class="n">abc</span><span class="p">,</span> <span class="n">hrange</span>
<span class="kn">from</span> <span class="nn">hypothesis.internal.coverage</span> <span class="k">import</span> <span class="n">check</span><span class="p">,</span> <span class="n">check_function</span>
<span class="kn">from</span> <span class="nn">hypothesis.internal.validation</span> <span class="k">import</span> <span class="p">(</span>
    <span class="n">check_type</span><span class="p">,</span>
    <span class="n">check_valid_interval</span><span class="p">,</span>
    <span class="n">check_valid_size</span><span class="p">,</span>
    <span class="n">try_convert</span><span class="p">,</span>
<span class="p">)</span>

<span class="k">try</span><span class="p">:</span>
    <span class="kn">from</span> <span class="nn">pandas.api.types</span> <span class="k">import</span> <span class="n">is_categorical_dtype</span>
<span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>  <span class="c1"># pragma: no cover</span>

    <span class="k">def</span> <span class="nf">is_categorical_dtype</span><span class="p">(</span><span class="n">dt</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">dt</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">dtype</span><span class="p">):</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="k">return</span> <span class="n">dt</span> <span class="o">==</span> <span class="s2">&quot;category&quot;</span>


<span class="k">if</span> <span class="kc">False</span><span class="p">:</span>
    <span class="kn">from</span> <span class="nn">typing</span> <span class="k">import</span> <span class="n">Any</span><span class="p">,</span> <span class="n">Union</span><span class="p">,</span> <span class="n">Sequence</span><span class="p">,</span> <span class="n">Set</span>  <span class="c1"># noqa</span>
    <span class="kn">from</span> <span class="nn">hypothesis.searchstrategy.strategies</span> <span class="k">import</span> <span class="n">Ex</span>  <span class="c1"># noqa</span>


<span class="k">def</span> <span class="nf">dtype_for_elements_strategy</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">st</span><span class="o">.</span><span class="n">shared</span><span class="p">(</span>
        <span class="n">s</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">pandas</span><span class="o">.</span><span class="n">Series</span><span class="p">([</span><span class="n">x</span><span class="p">])</span><span class="o">.</span><span class="n">dtype</span><span class="p">),</span>
        <span class="n">key</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;hypothesis.extra.pandas.dtype_for_elements_strategy&quot;</span><span class="p">,</span> <span class="n">s</span><span class="p">),</span>
    <span class="p">)</span>


<span class="k">def</span> <span class="nf">infer_dtype_if_necessary</span><span class="p">(</span><span class="n">dtype</span><span class="p">,</span> <span class="n">values</span><span class="p">,</span> <span class="n">elements</span><span class="p">,</span> <span class="n">draw</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">dtype</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">values</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">draw</span><span class="p">(</span><span class="n">dtype_for_elements_strategy</span><span class="p">(</span><span class="n">elements</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">dtype</span>


<span class="nd">@check_function</span>
<span class="k">def</span> <span class="nf">elements_and_dtype</span><span class="p">(</span><span class="n">elements</span><span class="p">,</span> <span class="n">dtype</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>

    <span class="k">if</span> <span class="n">source</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">prefix</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">prefix</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">.&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">source</span><span class="p">,)</span>

    <span class="k">if</span> <span class="n">elements</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">st</span><span class="o">.</span><span class="n">check_strategy</span><span class="p">(</span><span class="n">elements</span><span class="p">,</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">elements&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">prefix</span><span class="p">,))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">with</span> <span class="n">check</span><span class="p">(</span><span class="s2">&quot;dtype is not None&quot;</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">dtype</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">InvalidArgument</span><span class="p">(</span>
                    <span class="p">(</span>
                        <span class="s2">&quot;At least one of </span><span class="si">%(prefix)s</span><span class="s2">elements or </span><span class="si">%(prefix)s</span><span class="s2">dtype &quot;</span>
                        <span class="s2">&quot;must be provided.&quot;</span>
                    <span class="p">)</span>
                    <span class="o">%</span> <span class="p">{</span><span class="s2">&quot;prefix&quot;</span><span class="p">:</span> <span class="n">prefix</span><span class="p">}</span>
                <span class="p">)</span>

    <span class="k">with</span> <span class="n">check</span><span class="p">(</span><span class="s2">&quot;is_categorical_dtype&quot;</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">is_categorical_dtype</span><span class="p">(</span><span class="n">dtype</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">InvalidArgument</span><span class="p">(</span>
                <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">dtype is categorical, which is currently unsupported&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">prefix</span><span class="p">,)</span>
            <span class="p">)</span>

    <span class="n">dtype</span> <span class="o">=</span> <span class="n">try_convert</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">dtype</span><span class="p">,</span> <span class="n">dtype</span><span class="p">,</span> <span class="s2">&quot;dtype&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">elements</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">elements</span> <span class="o">=</span> <span class="n">npst</span><span class="o">.</span><span class="n">from_dtype</span><span class="p">(</span><span class="n">dtype</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">dtype</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>

        <span class="k">def</span> <span class="nf">convert_element</span><span class="p">(</span><span class="n">value</span><span class="p">):</span>
            <span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;draw(</span><span class="si">%s</span><span class="s2">elements)&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">prefix</span><span class="p">,)</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">value</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">dtype</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">InvalidArgument</span><span class="p">(</span>
                    <span class="s2">&quot;Cannot convert </span><span class="si">%s</span><span class="s2">=</span><span class="si">%r</span><span class="s2"> of type </span><span class="si">%s</span><span class="s2"> to dtype </span><span class="si">%s</span><span class="s2">&quot;</span>
                    <span class="o">%</span> <span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="nb">type</span><span class="p">(</span><span class="n">value</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span> <span class="n">dtype</span><span class="o">.</span><span class="n">str</span><span class="p">)</span>
                <span class="p">)</span>
            <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">InvalidArgument</span><span class="p">(</span>
                    <span class="s2">&quot;Cannot convert </span><span class="si">%s</span><span class="s2">=</span><span class="si">%r</span><span class="s2"> to type </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">dtype</span><span class="o">.</span><span class="n">str</span><span class="p">)</span>
                <span class="p">)</span>

        <span class="n">elements</span> <span class="o">=</span> <span class="n">elements</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">convert_element</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">elements</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>

    <span class="k">return</span> <span class="n">elements</span><span class="p">,</span> <span class="n">dtype</span>


<span class="k">class</span> <span class="nc">ValueIndexStrategy</span><span class="p">(</span><span class="n">st</span><span class="o">.</span><span class="n">SearchStrategy</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">elements</span><span class="p">,</span> <span class="n">dtype</span><span class="p">,</span> <span class="n">min_size</span><span class="p">,</span> <span class="n">max_size</span><span class="p">,</span> <span class="n">unique</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">ValueIndexStrategy</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">elements</span> <span class="o">=</span> <span class="n">elements</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dtype</span> <span class="o">=</span> <span class="n">dtype</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">min_size</span> <span class="o">=</span> <span class="n">min_size</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">max_size</span> <span class="o">=</span> <span class="n">max_size</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">unique</span> <span class="o">=</span> <span class="n">unique</span>

    <span class="k">def</span> <span class="nf">do_draw</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
        <span class="n">result</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">seen</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>

        <span class="n">iterator</span> <span class="o">=</span> <span class="n">cu</span><span class="o">.</span><span class="n">many</span><span class="p">(</span>
            <span class="n">data</span><span class="p">,</span>
            <span class="n">min_size</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">min_size</span><span class="p">,</span>
            <span class="n">max_size</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">max_size</span><span class="p">,</span>
            <span class="n">average_size</span><span class="o">=</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">min_size</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_size</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="k">while</span> <span class="n">iterator</span><span class="o">.</span><span class="n">more</span><span class="p">():</span>
            <span class="n">elt</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">draw</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">elements</span><span class="p">)</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">unique</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">elt</span> <span class="ow">in</span> <span class="n">seen</span><span class="p">:</span>
                    <span class="n">iterator</span><span class="o">.</span><span class="n">reject</span><span class="p">()</span>
                    <span class="k">continue</span>
                <span class="n">seen</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">elt</span><span class="p">)</span>
            <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">elt</span><span class="p">)</span>

        <span class="n">dtype</span> <span class="o">=</span> <span class="n">infer_dtype_if_necessary</span><span class="p">(</span>
            <span class="n">dtype</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dtype</span><span class="p">,</span> <span class="n">values</span><span class="o">=</span><span class="n">result</span><span class="p">,</span> <span class="n">elements</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">elements</span><span class="p">,</span> <span class="n">draw</span><span class="o">=</span><span class="n">data</span><span class="o">.</span><span class="n">draw</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">pandas</span><span class="o">.</span><span class="n">Index</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">dtype</span><span class="p">,</span> <span class="n">tupleize_cols</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>


<span class="n">DEFAULT_MAX_SIZE</span> <span class="o">=</span> <span class="mi">10</span>


<div class="viewcode-block" id="range_indexes"><a class="viewcode-back" href="../../../../numpy.html#hypothesis.extra.pandas.range_indexes">[docs]</a><span class="nd">@st</span><span class="o">.</span><span class="n">cacheable</span>
<span class="nd">@st</span><span class="o">.</span><span class="n">defines_strategy</span>
<span class="k">def</span> <span class="nf">range_indexes</span><span class="p">(</span><span class="n">min_size</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">max_size</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="c1"># type: (int, int) -&gt; st.SearchStrategy[pandas.RangeIndex]</span>
    <span class="sd">&quot;&quot;&quot;Provides a strategy which generates an :class:`~pandas.Index` whose</span>
<span class="sd">    values are 0, 1, ..., n for some n.</span>

<span class="sd">    Arguments:</span>

<span class="sd">    * min_size is the smallest number of elements the index can have.</span>
<span class="sd">    * max_size is the largest number of elements the index can have. If None</span>
<span class="sd">      it will default to some suitable value based on min_size.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">check_valid_size</span><span class="p">(</span><span class="n">min_size</span><span class="p">,</span> <span class="s2">&quot;min_size&quot;</span><span class="p">)</span>
    <span class="n">check_valid_size</span><span class="p">(</span><span class="n">max_size</span><span class="p">,</span> <span class="s2">&quot;max_size&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">max_size</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">max_size</span> <span class="o">=</span> <span class="nb">min</span><span class="p">([</span><span class="n">min_size</span> <span class="o">+</span> <span class="n">DEFAULT_MAX_SIZE</span><span class="p">,</span> <span class="mi">2</span> <span class="o">**</span> <span class="mi">63</span> <span class="o">-</span> <span class="mi">1</span><span class="p">])</span>
    <span class="n">check_valid_interval</span><span class="p">(</span><span class="n">min_size</span><span class="p">,</span> <span class="n">max_size</span><span class="p">,</span> <span class="s2">&quot;min_size&quot;</span><span class="p">,</span> <span class="s2">&quot;max_size&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">st</span><span class="o">.</span><span class="n">integers</span><span class="p">(</span><span class="n">min_size</span><span class="p">,</span> <span class="n">max_size</span><span class="p">)</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">pandas</span><span class="o">.</span><span class="n">RangeIndex</span><span class="p">)</span></div>


<div class="viewcode-block" id="indexes"><a class="viewcode-back" href="../../../../numpy.html#hypothesis.extra.pandas.indexes">[docs]</a><span class="nd">@st</span><span class="o">.</span><span class="n">cacheable</span>
<span class="nd">@st</span><span class="o">.</span><span class="n">defines_strategy</span>
<span class="k">def</span> <span class="nf">indexes</span><span class="p">(</span>
    <span class="n">elements</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>  <span class="c1"># type: st.SearchStrategy[Ex]</span>
    <span class="n">dtype</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>  <span class="c1"># type: Any</span>
    <span class="n">min_size</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>  <span class="c1"># type: int</span>
    <span class="n">max_size</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>  <span class="c1"># type: int</span>
    <span class="n">unique</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>  <span class="c1"># type: bool</span>
<span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Provides a strategy for producing a :class:`pandas.Index`.</span>

<span class="sd">    Arguments:</span>

<span class="sd">    * elements is a strategy which will be used to generate the individual</span>
<span class="sd">      values of the index. If None, it will be inferred from the dtype. Note:</span>
<span class="sd">      even if the elements strategy produces tuples, the generated value</span>
<span class="sd">      will not be a MultiIndex, but instead be a normal index whose elements</span>
<span class="sd">      are tuples.</span>
<span class="sd">    * dtype is the dtype of the resulting index. If None, it will be inferred</span>
<span class="sd">      from the elements strategy. At least one of dtype or elements must be</span>
<span class="sd">      provided.</span>
<span class="sd">    * min_size is the minimum number of elements in the index.</span>
<span class="sd">    * max_size is the maximum number of elements in the index. If None then it</span>
<span class="sd">      will default to a suitable small size. If you want larger indexes you</span>
<span class="sd">      should pass a max_size explicitly.</span>
<span class="sd">    * unique specifies whether all of the elements in the resulting index</span>
<span class="sd">      should be distinct.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">check_valid_size</span><span class="p">(</span><span class="n">min_size</span><span class="p">,</span> <span class="s2">&quot;min_size&quot;</span><span class="p">)</span>
    <span class="n">check_valid_size</span><span class="p">(</span><span class="n">max_size</span><span class="p">,</span> <span class="s2">&quot;max_size&quot;</span><span class="p">)</span>
    <span class="n">check_valid_interval</span><span class="p">(</span><span class="n">min_size</span><span class="p">,</span> <span class="n">max_size</span><span class="p">,</span> <span class="s2">&quot;min_size&quot;</span><span class="p">,</span> <span class="s2">&quot;max_size&quot;</span><span class="p">)</span>
    <span class="n">check_type</span><span class="p">(</span><span class="nb">bool</span><span class="p">,</span> <span class="n">unique</span><span class="p">,</span> <span class="s2">&quot;unique&quot;</span><span class="p">)</span>

    <span class="n">elements</span><span class="p">,</span> <span class="n">dtype</span> <span class="o">=</span> <span class="n">elements_and_dtype</span><span class="p">(</span><span class="n">elements</span><span class="p">,</span> <span class="n">dtype</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">max_size</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">max_size</span> <span class="o">=</span> <span class="n">min_size</span> <span class="o">+</span> <span class="n">DEFAULT_MAX_SIZE</span>
    <span class="k">return</span> <span class="n">ValueIndexStrategy</span><span class="p">(</span><span class="n">elements</span><span class="p">,</span> <span class="n">dtype</span><span class="p">,</span> <span class="n">min_size</span><span class="p">,</span> <span class="n">max_size</span><span class="p">,</span> <span class="n">unique</span><span class="p">)</span></div>


<div class="viewcode-block" id="series"><a class="viewcode-back" href="../../../../numpy.html#hypothesis.extra.pandas.series">[docs]</a><span class="nd">@st</span><span class="o">.</span><span class="n">defines_strategy</span>
<span class="k">def</span> <span class="nf">series</span><span class="p">(</span>
    <span class="n">elements</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>  <span class="c1"># type: st.SearchStrategy[Ex]</span>
    <span class="n">dtype</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>  <span class="c1"># type: Any</span>
    <span class="n">index</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>  <span class="c1"># type: st.SearchStrategy[Union[Sequence, pandas.Index]]</span>
    <span class="n">fill</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>  <span class="c1"># type: st.SearchStrategy[Ex]</span>
    <span class="n">unique</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>  <span class="c1"># type: bool</span>
<span class="p">):</span>
    <span class="c1"># type: (...) -&gt; st.SearchStrategy[pandas.Series]</span>
    <span class="sd">&quot;&quot;&quot;Provides a strategy for producing a :class:`pandas.Series`.</span>

<span class="sd">    Arguments:</span>

<span class="sd">    * elements: a strategy that will be used to generate the individual</span>
<span class="sd">      values in the series. If None, we will attempt to infer a suitable</span>
<span class="sd">      default from the dtype.</span>

<span class="sd">    * dtype: the dtype of the resulting series and may be any value</span>
<span class="sd">      that can be passed to :class:`numpy.dtype`. If None, will use</span>
<span class="sd">      pandas&#39;s standard behaviour to infer it from the type of the elements</span>
<span class="sd">      values. Note that if the type of values that comes out of your</span>
<span class="sd">      elements strategy varies, then so will the resulting dtype of the</span>
<span class="sd">      series.</span>

<span class="sd">    * index: If not None, a strategy for generating indexes for the</span>
<span class="sd">      resulting Series. This can generate either :class:`pandas.Index`</span>
<span class="sd">      objects or any sequence of values (which will be passed to the</span>
<span class="sd">      Index constructor).</span>

<span class="sd">      You will probably find it most convenient to use the</span>
<span class="sd">      :func:`~hypothesis.extra.pandas.indexes` or</span>
<span class="sd">      :func:`~hypothesis.extra.pandas.range_indexes` function to produce</span>
<span class="sd">      values for this argument.</span>

<span class="sd">    Usage:</span>

<span class="sd">    .. code-block:: pycon</span>

<span class="sd">        &gt;&gt;&gt; series(dtype=int).example()</span>
<span class="sd">        0   -2001747478</span>
<span class="sd">        1    1153062837</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">index</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">index</span> <span class="o">=</span> <span class="n">range_indexes</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">st</span><span class="o">.</span><span class="n">check_strategy</span><span class="p">(</span><span class="n">index</span><span class="p">)</span>

    <span class="n">elements</span><span class="p">,</span> <span class="n">dtype</span> <span class="o">=</span> <span class="n">elements_and_dtype</span><span class="p">(</span><span class="n">elements</span><span class="p">,</span> <span class="n">dtype</span><span class="p">)</span>
    <span class="n">index_strategy</span> <span class="o">=</span> <span class="n">index</span>

    <span class="nd">@st</span><span class="o">.</span><span class="n">composite</span>
    <span class="k">def</span> <span class="nf">result</span><span class="p">(</span><span class="n">draw</span><span class="p">):</span>
        <span class="n">index</span> <span class="o">=</span> <span class="n">draw</span><span class="p">(</span><span class="n">index_strategy</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">index</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">dtype</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">result_data</span> <span class="o">=</span> <span class="n">draw</span><span class="p">(</span>
                    <span class="n">npst</span><span class="o">.</span><span class="n">arrays</span><span class="p">(</span>
                        <span class="n">dtype</span><span class="o">=</span><span class="n">dtype</span><span class="p">,</span>
                        <span class="n">elements</span><span class="o">=</span><span class="n">elements</span><span class="p">,</span>
                        <span class="n">shape</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">index</span><span class="p">),</span>
                        <span class="n">fill</span><span class="o">=</span><span class="n">fill</span><span class="p">,</span>
                        <span class="n">unique</span><span class="o">=</span><span class="n">unique</span><span class="p">,</span>
                    <span class="p">)</span>
                <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">result_data</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span>
                    <span class="n">draw</span><span class="p">(</span>
                        <span class="n">npst</span><span class="o">.</span><span class="n">arrays</span><span class="p">(</span>
                            <span class="n">dtype</span><span class="o">=</span><span class="nb">object</span><span class="p">,</span>
                            <span class="n">elements</span><span class="o">=</span><span class="n">elements</span><span class="p">,</span>
                            <span class="n">shape</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">index</span><span class="p">),</span>
                            <span class="n">fill</span><span class="o">=</span><span class="n">fill</span><span class="p">,</span>
                            <span class="n">unique</span><span class="o">=</span><span class="n">unique</span><span class="p">,</span>
                        <span class="p">)</span>
                    <span class="p">)</span>
                <span class="p">)</span>

            <span class="k">return</span> <span class="n">pandas</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">result_data</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">index</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">dtype</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">pandas</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span>
                <span class="p">(),</span>
                <span class="n">index</span><span class="o">=</span><span class="n">index</span><span class="p">,</span>
                <span class="n">dtype</span><span class="o">=</span><span class="n">dtype</span>
                <span class="k">if</span> <span class="n">dtype</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
                <span class="k">else</span> <span class="n">draw</span><span class="p">(</span><span class="n">dtype_for_elements_strategy</span><span class="p">(</span><span class="n">elements</span><span class="p">)),</span>
            <span class="p">)</span>

    <span class="k">return</span> <span class="n">result</span><span class="p">()</span></div>


<div class="viewcode-block" id="column"><a class="viewcode-back" href="../../../../numpy.html#hypothesis.extra.pandas.column">[docs]</a><span class="nd">@attr</span><span class="o">.</span><span class="n">s</span><span class="p">(</span><span class="n">slots</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">column</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Data object for describing a column in a DataFrame.</span>

<span class="sd">    Arguments:</span>

<span class="sd">    * name: the column name, or None to default to the column position. Must</span>
<span class="sd">      be hashable, but can otherwise be any value supported as a pandas column</span>
<span class="sd">      name.</span>
<span class="sd">    * elements: the strategy for generating values in this column, or None</span>
<span class="sd">      to infer it from the dtype.</span>
<span class="sd">    * dtype: the dtype of the column, or None to infer it from the element</span>
<span class="sd">      strategy. At least one of dtype or elements must be provided.</span>
<span class="sd">    * fill: A default value for elements of the column. See</span>
<span class="sd">      :func:`~hypothesis.extra.numpy.arrays` for a full explanation.</span>
<span class="sd">    * unique: If all values in this column should be distinct.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">name</span> <span class="o">=</span> <span class="n">attr</span><span class="o">.</span><span class="n">ib</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
    <span class="n">elements</span> <span class="o">=</span> <span class="n">attr</span><span class="o">.</span><span class="n">ib</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
    <span class="n">dtype</span> <span class="o">=</span> <span class="n">attr</span><span class="o">.</span><span class="n">ib</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
    <span class="n">fill</span> <span class="o">=</span> <span class="n">attr</span><span class="o">.</span><span class="n">ib</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
    <span class="n">unique</span> <span class="o">=</span> <span class="n">attr</span><span class="o">.</span><span class="n">ib</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></div>


<div class="viewcode-block" id="columns"><a class="viewcode-back" href="../../../../numpy.html#hypothesis.extra.pandas.columns">[docs]</a><span class="k">def</span> <span class="nf">columns</span><span class="p">(</span>
    <span class="n">names_or_number</span><span class="p">,</span>  <span class="c1"># type: Union[int, Sequence[str]]</span>
    <span class="n">dtype</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>  <span class="c1"># type: Any</span>
    <span class="n">elements</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>  <span class="c1"># type: st.SearchStrategy[Ex]</span>
    <span class="n">fill</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>  <span class="c1"># type: st.SearchStrategy[Ex]</span>
    <span class="n">unique</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>  <span class="c1"># type: bool</span>
<span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;A convenience function for producing a list of :class:`column` objects</span>
<span class="sd">    of the same general shape.</span>

<span class="sd">    The names_or_number argument is either a sequence of values, the</span>
<span class="sd">    elements of which will be used as the name for individual column</span>
<span class="sd">    objects, or a number, in which case that many unnamed columns will</span>
<span class="sd">    be created. All other arguments are passed through verbatim to</span>
<span class="sd">    create the columns.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">names_or_number</span><span class="p">,</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">)):</span>
        <span class="n">names</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span><span class="p">]</span> <span class="o">*</span> <span class="n">names_or_number</span>  <span class="c1"># type: list</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">names</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">names_or_number</span><span class="p">)</span>
    <span class="k">return</span> <span class="p">[</span>
        <span class="n">column</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">n</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">dtype</span><span class="p">,</span> <span class="n">elements</span><span class="o">=</span><span class="n">elements</span><span class="p">,</span> <span class="n">fill</span><span class="o">=</span><span class="n">fill</span><span class="p">,</span> <span class="n">unique</span><span class="o">=</span><span class="n">unique</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">names</span>
    <span class="p">]</span></div>


<div class="viewcode-block" id="data_frames"><a class="viewcode-back" href="../../../../numpy.html#hypothesis.extra.pandas.data_frames">[docs]</a><span class="nd">@st</span><span class="o">.</span><span class="n">defines_strategy</span>
<span class="k">def</span> <span class="nf">data_frames</span><span class="p">(</span>
    <span class="n">columns</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>  <span class="c1"># type: Sequence[column]</span>
    <span class="n">rows</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>  <span class="c1"># type: st.SearchStrategy[Union[dict, Sequence[Any]]]</span>
    <span class="n">index</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>  <span class="c1"># type: st.SearchStrategy[Ex]</span>
<span class="p">):</span>
    <span class="c1"># type: (...) -&gt; st.SearchStrategy[pandas.DataFrame]</span>
    <span class="sd">&quot;&quot;&quot;Provides a strategy for producing a :class:`pandas.DataFrame`.</span>

<span class="sd">    Arguments:</span>

<span class="sd">    * columns: An iterable of :class:`column` objects describing the shape</span>
<span class="sd">      of the generated DataFrame.</span>

<span class="sd">    * rows: A strategy for generating a row object. Should generate</span>
<span class="sd">      either dicts mapping column names to values or a sequence mapping</span>
<span class="sd">      column position to the value in that position (note that unlike the</span>
<span class="sd">      :class:`pandas.DataFrame` constructor, single values are not allowed</span>
<span class="sd">      here. Passing e.g. an integer is an error, even if there is only one</span>
<span class="sd">      column).</span>

<span class="sd">      At least one of rows and columns must be provided. If both are</span>
<span class="sd">      provided then the generated rows will be validated against the</span>
<span class="sd">      columns and an error will be raised if they don&#39;t match.</span>

<span class="sd">      Caveats on using rows:</span>

<span class="sd">      * In general you should prefer using columns to rows, and only use</span>
<span class="sd">        rows if the columns interface is insufficiently flexible to</span>
<span class="sd">        describe what you need - you will get better performance and</span>
<span class="sd">        example quality that way.</span>
<span class="sd">      * If you provide rows and not columns, then the shape and dtype of</span>
<span class="sd">        the resulting DataFrame may vary. e.g. if you have a mix of int</span>
<span class="sd">        and float in the values for one column in your row entries, the</span>
<span class="sd">        column will sometimes have an integral dtype and sometimes a float.</span>

<span class="sd">    * index: If not None, a strategy for generating indexes for the</span>
<span class="sd">      resulting DataFrame. This can generate either :class:`pandas.Index`</span>
<span class="sd">      objects or any sequence of values (which will be passed to the</span>
<span class="sd">      Index constructor).</span>

<span class="sd">      You will probably find it most convenient to use the</span>
<span class="sd">      :func:`~hypothesis.extra.pandas.indexes` or</span>
<span class="sd">      :func:`~hypothesis.extra.pandas.range_indexes` function to produce</span>
<span class="sd">      values for this argument.</span>

<span class="sd">    Usage:</span>

<span class="sd">    The expected usage pattern is that you use :class:`column` and</span>
<span class="sd">    :func:`columns` to specify a fixed shape of the DataFrame you want as</span>
<span class="sd">    follows. For example the following gives a two column data frame:</span>

<span class="sd">    .. code-block:: pycon</span>

<span class="sd">        &gt;&gt;&gt; from hypothesis.extra.pandas import column, data_frames</span>
<span class="sd">        &gt;&gt;&gt; data_frames([</span>
<span class="sd">        ... column(&#39;A&#39;, dtype=int), column(&#39;B&#39;, dtype=float)]).example()</span>
<span class="sd">                    A              B</span>
<span class="sd">        0  2021915903  1.793898e+232</span>
<span class="sd">        1  1146643993            inf</span>
<span class="sd">        2 -2096165693   1.000000e+07</span>

<span class="sd">    If you want the values in different columns to interact in some way you</span>
<span class="sd">    can use the rows argument. For example the following gives a two column</span>
<span class="sd">    DataFrame where the value in the first column is always at most the value</span>
<span class="sd">    in the second:</span>

<span class="sd">    .. code-block:: pycon</span>

<span class="sd">        &gt;&gt;&gt; from hypothesis.extra.pandas import column, data_frames</span>
<span class="sd">        &gt;&gt;&gt; import hypothesis.strategies as st</span>
<span class="sd">        &gt;&gt;&gt; data_frames(</span>
<span class="sd">        ...     rows=st.tuples(st.floats(allow_nan=False),</span>
<span class="sd">        ...                    st.floats(allow_nan=False)).map(sorted)</span>
<span class="sd">        ... ).example()</span>
<span class="sd">                       0             1</span>
<span class="sd">        0  -3.402823e+38  9.007199e+15</span>
<span class="sd">        1 -1.562796e-298  5.000000e-01</span>

<span class="sd">    You can also combine the two:</span>

<span class="sd">    .. code-block:: pycon</span>

<span class="sd">        &gt;&gt;&gt; from hypothesis.extra.pandas import columns, data_frames</span>
<span class="sd">        &gt;&gt;&gt; import hypothesis.strategies as st</span>
<span class="sd">        &gt;&gt;&gt; data_frames(</span>
<span class="sd">        ...     columns=columns([&quot;lo&quot;, &quot;hi&quot;], dtype=float),</span>
<span class="sd">        ...     rows=st.tuples(st.floats(allow_nan=False),</span>
<span class="sd">        ...                    st.floats(allow_nan=False)).map(sorted)</span>
<span class="sd">        ... ).example()</span>
<span class="sd">                 lo            hi</span>
<span class="sd">        0   9.314723e-49  4.353037e+45</span>
<span class="sd">        1  -9.999900e-01  1.000000e+07</span>
<span class="sd">        2 -2.152861e+134 -1.069317e-73</span>

<span class="sd">    (Note that the column dtype must still be specified and will not be</span>
<span class="sd">    inferred from the rows. This restriction may be lifted in future).</span>

<span class="sd">    Combining rows and columns has the following behaviour:</span>

<span class="sd">    * The column names and dtypes will be used.</span>
<span class="sd">    * If the column is required to be unique, this will be enforced.</span>
<span class="sd">    * Any values missing from the generated rows will be provided using the</span>
<span class="sd">      column&#39;s fill.</span>
<span class="sd">    * Any values in the row not present in the column specification (if</span>
<span class="sd">      dicts are passed, if there are keys with no corresponding column name,</span>
<span class="sd">      if sequences are passed if there are too many items) will result in</span>
<span class="sd">      InvalidArgument being raised.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">index</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">index</span> <span class="o">=</span> <span class="n">range_indexes</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">st</span><span class="o">.</span><span class="n">check_strategy</span><span class="p">(</span><span class="n">index</span><span class="p">)</span>

    <span class="n">index_strategy</span> <span class="o">=</span> <span class="n">index</span>

    <span class="k">if</span> <span class="n">columns</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">rows</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">InvalidArgument</span><span class="p">(</span><span class="s2">&quot;At least one of rows and columns must be provided&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>

            <span class="nd">@st</span><span class="o">.</span><span class="n">composite</span>
            <span class="k">def</span> <span class="nf">rows_only</span><span class="p">(</span><span class="n">draw</span><span class="p">):</span>
                <span class="n">index</span> <span class="o">=</span> <span class="n">draw</span><span class="p">(</span><span class="n">index_strategy</span><span class="p">)</span>

                <span class="nd">@check_function</span>
                <span class="k">def</span> <span class="nf">row</span><span class="p">():</span>
                    <span class="n">result</span> <span class="o">=</span> <span class="n">draw</span><span class="p">(</span><span class="n">rows</span><span class="p">)</span>
                    <span class="n">check_type</span><span class="p">(</span><span class="n">abc</span><span class="o">.</span><span class="n">Iterable</span><span class="p">,</span> <span class="n">result</span><span class="p">,</span> <span class="s2">&quot;draw(row)&quot;</span><span class="p">)</span>
                    <span class="k">return</span> <span class="n">result</span>

                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">index</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="k">return</span> <span class="n">pandas</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">([</span><span class="n">row</span><span class="p">()</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">index</span><span class="p">],</span> <span class="n">index</span><span class="o">=</span><span class="n">index</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="c1"># If we haven&#39;t drawn any rows we need to draw one row and</span>
                    <span class="c1"># then discard it so that we get a consistent shape for the</span>
                    <span class="c1"># DataFrame.</span>
                    <span class="n">base</span> <span class="o">=</span> <span class="n">pandas</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">([</span><span class="n">row</span><span class="p">()])</span>
                    <span class="k">return</span> <span class="n">base</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

            <span class="k">return</span> <span class="n">rows_only</span><span class="p">()</span>

    <span class="k">assert</span> <span class="n">columns</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
    <span class="n">cols</span> <span class="o">=</span> <span class="n">try_convert</span><span class="p">(</span><span class="nb">tuple</span><span class="p">,</span> <span class="n">columns</span><span class="p">,</span> <span class="s2">&quot;columns&quot;</span><span class="p">)</span>  <span class="c1"># type: Sequence[column]</span>

    <span class="n">rewritten_columns</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">column_names</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>  <span class="c1"># type: Set[str]</span>

    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">c</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">cols</span><span class="p">):</span>
        <span class="n">check_type</span><span class="p">(</span><span class="n">column</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="s2">&quot;columns[</span><span class="si">%d</span><span class="s2">]&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">i</span><span class="p">,))</span>

        <span class="n">c</span> <span class="o">=</span> <span class="n">copy</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">c</span><span class="o">.</span><span class="n">name</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">label</span> <span class="o">=</span> <span class="s2">&quot;columns[</span><span class="si">%d</span><span class="s2">]&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">i</span><span class="p">,)</span>
            <span class="n">c</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">i</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">label</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">name</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="nb">hash</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">InvalidArgument</span><span class="p">(</span>
                    <span class="s2">&quot;Column names must be hashable, but columns[</span><span class="si">%d</span><span class="s2">].name was &quot;</span>
                    <span class="s2">&quot;</span><span class="si">%r</span><span class="s2"> of type </span><span class="si">%s</span><span class="s2">, which cannot be hashed.&quot;</span>
                    <span class="o">%</span> <span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">c</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="nb">type</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">name</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span>
                <span class="p">)</span>

        <span class="k">if</span> <span class="n">c</span><span class="o">.</span><span class="n">name</span> <span class="ow">in</span> <span class="n">column_names</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">InvalidArgument</span><span class="p">(</span><span class="s2">&quot;duplicate definition of column name </span><span class="si">%r</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">name</span><span class="p">,))</span>

        <span class="n">column_names</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>

        <span class="n">c</span><span class="o">.</span><span class="n">elements</span><span class="p">,</span> <span class="n">c</span><span class="o">.</span><span class="n">dtype</span> <span class="o">=</span> <span class="n">elements_and_dtype</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">elements</span><span class="p">,</span> <span class="n">c</span><span class="o">.</span><span class="n">dtype</span><span class="p">,</span> <span class="n">label</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">c</span><span class="o">.</span><span class="n">dtype</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">rows</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">InvalidArgument</span><span class="p">(</span>
                <span class="s2">&quot;Must specify a dtype for all columns when combining rows with&quot;</span>
                <span class="s2">&quot; columns.&quot;</span>
            <span class="p">)</span>

        <span class="n">c</span><span class="o">.</span><span class="n">fill</span> <span class="o">=</span> <span class="n">npst</span><span class="o">.</span><span class="n">fill_for</span><span class="p">(</span>
            <span class="n">fill</span><span class="o">=</span><span class="n">c</span><span class="o">.</span><span class="n">fill</span><span class="p">,</span> <span class="n">elements</span><span class="o">=</span><span class="n">c</span><span class="o">.</span><span class="n">elements</span><span class="p">,</span> <span class="n">unique</span><span class="o">=</span><span class="n">c</span><span class="o">.</span><span class="n">unique</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">label</span>
        <span class="p">)</span>

        <span class="n">rewritten_columns</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">rows</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>

        <span class="nd">@st</span><span class="o">.</span><span class="n">composite</span>
        <span class="k">def</span> <span class="nf">just_draw_columns</span><span class="p">(</span><span class="n">draw</span><span class="p">):</span>
            <span class="n">index</span> <span class="o">=</span> <span class="n">draw</span><span class="p">(</span><span class="n">index_strategy</span><span class="p">)</span>
            <span class="n">local_index_strategy</span> <span class="o">=</span> <span class="n">st</span><span class="o">.</span><span class="n">just</span><span class="p">(</span><span class="n">index</span><span class="p">)</span>

            <span class="n">data</span> <span class="o">=</span> <span class="n">OrderedDict</span><span class="p">((</span><span class="n">c</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">rewritten_columns</span><span class="p">)</span>

            <span class="c1"># Depending on how the columns are going to be generated we group</span>
            <span class="c1"># them differently to get better shrinking. For columns with fill</span>
            <span class="c1"># enabled, the elements can be shrunk independently of the size,</span>
            <span class="c1"># so we can just shrink by shrinking the index then shrinking the</span>
            <span class="c1"># length and are generally much more free to move data around.</span>

            <span class="c1"># For columns with no filling the problem is harder, and drawing</span>
            <span class="c1"># them like that would result in rows being very far apart from</span>
            <span class="c1"># each other in the underlying data stream, which gets in the way</span>
            <span class="c1"># of shrinking. So what we do is reorder and draw those columns</span>
            <span class="c1"># row wise, so that the values of each row are next to each other.</span>
            <span class="c1"># This makes life easier for the shrinker when deleting blocks of</span>
            <span class="c1"># data.</span>
            <span class="n">columns_without_fill</span> <span class="o">=</span> <span class="p">[</span><span class="n">c</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">rewritten_columns</span> <span class="k">if</span> <span class="n">c</span><span class="o">.</span><span class="n">fill</span><span class="o">.</span><span class="n">is_empty</span><span class="p">]</span>

            <span class="k">if</span> <span class="n">columns_without_fill</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">columns_without_fill</span><span class="p">:</span>
                    <span class="n">data</span><span class="p">[</span><span class="n">c</span><span class="o">.</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">pandas</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span>
                        <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">index</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">c</span><span class="o">.</span><span class="n">dtype</span><span class="p">),</span> <span class="n">index</span><span class="o">=</span><span class="n">index</span>
                    <span class="p">)</span>
                <span class="n">seen</span> <span class="o">=</span> <span class="p">{</span><span class="n">c</span><span class="o">.</span><span class="n">name</span><span class="p">:</span> <span class="nb">set</span><span class="p">()</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">columns_without_fill</span> <span class="k">if</span> <span class="n">c</span><span class="o">.</span><span class="n">unique</span><span class="p">}</span>

                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">hrange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">index</span><span class="p">)):</span>
                    <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">columns_without_fill</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">c</span><span class="o">.</span><span class="n">unique</span><span class="p">:</span>
                            <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">):</span>
                                <span class="n">value</span> <span class="o">=</span> <span class="n">draw</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">elements</span><span class="p">)</span>
                                <span class="k">if</span> <span class="n">value</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">seen</span><span class="p">[</span><span class="n">c</span><span class="o">.</span><span class="n">name</span><span class="p">]:</span>
                                    <span class="n">seen</span><span class="p">[</span><span class="n">c</span><span class="o">.</span><span class="n">name</span><span class="p">]</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
                                    <span class="k">break</span>
                            <span class="k">else</span><span class="p">:</span>
                                <span class="n">reject</span><span class="p">()</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">value</span> <span class="o">=</span> <span class="n">draw</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">elements</span><span class="p">)</span>
                        <span class="n">data</span><span class="p">[</span><span class="n">c</span><span class="o">.</span><span class="n">name</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>

            <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">rewritten_columns</span><span class="p">:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">c</span><span class="o">.</span><span class="n">fill</span><span class="o">.</span><span class="n">is_empty</span><span class="p">:</span>
                    <span class="n">data</span><span class="p">[</span><span class="n">c</span><span class="o">.</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">draw</span><span class="p">(</span>
                        <span class="n">series</span><span class="p">(</span>
                            <span class="n">index</span><span class="o">=</span><span class="n">local_index_strategy</span><span class="p">,</span>
                            <span class="n">dtype</span><span class="o">=</span><span class="n">c</span><span class="o">.</span><span class="n">dtype</span><span class="p">,</span>
                            <span class="n">elements</span><span class="o">=</span><span class="n">c</span><span class="o">.</span><span class="n">elements</span><span class="p">,</span>
                            <span class="n">fill</span><span class="o">=</span><span class="n">c</span><span class="o">.</span><span class="n">fill</span><span class="p">,</span>
                            <span class="n">unique</span><span class="o">=</span><span class="n">c</span><span class="o">.</span><span class="n">unique</span><span class="p">,</span>
                        <span class="p">)</span>
                    <span class="p">)</span>

            <span class="k">return</span> <span class="n">pandas</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">index</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">just_draw_columns</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>

        <span class="nd">@st</span><span class="o">.</span><span class="n">composite</span>
        <span class="k">def</span> <span class="nf">assign_rows</span><span class="p">(</span><span class="n">draw</span><span class="p">):</span>
            <span class="n">index</span> <span class="o">=</span> <span class="n">draw</span><span class="p">(</span><span class="n">index_strategy</span><span class="p">)</span>

            <span class="n">result</span> <span class="o">=</span> <span class="n">pandas</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
                <span class="n">OrderedDict</span><span class="p">(</span>
                    <span class="p">(</span>
                        <span class="n">c</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
                        <span class="n">pandas</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span>
                            <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">dtype</span><span class="o">=</span><span class="n">c</span><span class="o">.</span><span class="n">dtype</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">index</span><span class="p">)),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">c</span><span class="o">.</span><span class="n">dtype</span>
                        <span class="p">),</span>
                    <span class="p">)</span>
                    <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">rewritten_columns</span>
                <span class="p">),</span>
                <span class="n">index</span><span class="o">=</span><span class="n">index</span><span class="p">,</span>
            <span class="p">)</span>

            <span class="n">fills</span> <span class="o">=</span> <span class="p">{}</span>

            <span class="n">any_unique</span> <span class="o">=</span> <span class="nb">any</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">unique</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">rewritten_columns</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">any_unique</span><span class="p">:</span>
                <span class="n">all_seen</span> <span class="o">=</span> <span class="p">[</span><span class="nb">set</span><span class="p">()</span> <span class="k">if</span> <span class="n">c</span><span class="o">.</span><span class="n">unique</span> <span class="k">else</span> <span class="kc">None</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">rewritten_columns</span><span class="p">]</span>
                <span class="k">while</span> <span class="n">all_seen</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">all_seen</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>

            <span class="k">for</span> <span class="n">row_index</span> <span class="ow">in</span> <span class="n">hrange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">index</span><span class="p">)):</span>
                <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">hrange</span><span class="p">(</span><span class="mi">5</span><span class="p">):</span>
                    <span class="n">original_row</span> <span class="o">=</span> <span class="n">draw</span><span class="p">(</span><span class="n">rows</span><span class="p">)</span>
                    <span class="n">row</span> <span class="o">=</span> <span class="n">original_row</span>
                    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">row</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
                        <span class="n">as_list</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">rewritten_columns</span><span class="p">)</span>
                        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">c</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">rewritten_columns</span><span class="p">):</span>
                            <span class="k">try</span><span class="p">:</span>
                                <span class="n">as_list</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="n">c</span><span class="o">.</span><span class="n">name</span><span class="p">]</span>
                            <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                                <span class="k">try</span><span class="p">:</span>
                                    <span class="n">as_list</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">fills</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                                <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                                    <span class="n">fills</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">draw</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">fill</span><span class="p">)</span>
                                    <span class="n">as_list</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">fills</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">row</span><span class="p">:</span>
                            <span class="k">if</span> <span class="n">k</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">column_names</span><span class="p">:</span>
                                <span class="k">raise</span> <span class="n">InvalidArgument</span><span class="p">(</span>
                                    <span class="s2">&quot;Row </span><span class="si">%r</span><span class="s2"> contains column </span><span class="si">%r</span><span class="s2"> not in columns </span><span class="si">%r</span><span class="s2">)&quot;</span>
                                    <span class="o">%</span> <span class="p">(</span><span class="n">row</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="p">[</span><span class="n">c</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">rewritten_columns</span><span class="p">])</span>
                                <span class="p">)</span>
                        <span class="n">row</span> <span class="o">=</span> <span class="n">as_list</span>
                    <span class="k">if</span> <span class="n">any_unique</span><span class="p">:</span>
                        <span class="n">has_duplicate</span> <span class="o">=</span> <span class="kc">False</span>
                        <span class="k">for</span> <span class="n">seen</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">all_seen</span><span class="p">,</span> <span class="n">row</span><span class="p">):</span>
                            <span class="k">if</span> <span class="n">seen</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                                <span class="k">continue</span>
                            <span class="k">if</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">seen</span><span class="p">:</span>
                                <span class="n">has_duplicate</span> <span class="o">=</span> <span class="kc">True</span>
                                <span class="k">break</span>
                            <span class="n">seen</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
                        <span class="k">if</span> <span class="n">has_duplicate</span><span class="p">:</span>
                            <span class="k">continue</span>
                    <span class="n">row</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">try_convert</span><span class="p">(</span><span class="nb">tuple</span><span class="p">,</span> <span class="n">row</span><span class="p">,</span> <span class="s2">&quot;draw(rows)&quot;</span><span class="p">))</span>

                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">row</span><span class="p">)</span> <span class="o">&gt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">rewritten_columns</span><span class="p">):</span>
                        <span class="k">raise</span> <span class="n">InvalidArgument</span><span class="p">(</span>
                            <span class="p">(</span>
                                <span class="s2">&quot;Row </span><span class="si">%r</span><span class="s2"> contains too many entries. Has </span><span class="si">%d</span><span class="s2"> but &quot;</span>
                                <span class="s2">&quot;expected at most </span><span class="si">%d</span><span class="s2">&quot;</span>
                            <span class="p">)</span>
                            <span class="o">%</span> <span class="p">(</span><span class="n">original_row</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">row</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">rewritten_columns</span><span class="p">))</span>
                        <span class="p">)</span>
                    <span class="k">while</span> <span class="nb">len</span><span class="p">(</span><span class="n">row</span><span class="p">)</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">rewritten_columns</span><span class="p">):</span>
                        <span class="n">row</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">draw</span><span class="p">(</span><span class="n">rewritten_columns</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">row</span><span class="p">)]</span><span class="o">.</span><span class="n">fill</span><span class="p">))</span>
                    <span class="n">result</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">row_index</span><span class="p">]</span> <span class="o">=</span> <span class="n">row</span>
                    <span class="k">break</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">reject</span><span class="p">()</span>
            <span class="k">return</span> <span class="n">result</span>

        <span class="k">return</span> <span class="n">assign_rows</span><span class="p">()</span></div>
</pre></div>

           </div>
           
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2013-2019, David R. MacIver

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>